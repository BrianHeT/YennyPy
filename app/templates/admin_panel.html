<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Panel de Administraci√≥n</h1>

    <aside class="admin-sidebar">
        <nav>
            {# Enlaces de navegaci√≥n #}
            <a href="#books-management" class="sidebar-link active">üìö Gesti√≥n de Libros</a>
            <a href="#queries-review" class="sidebar-link">üìß Consultas/Propuestas</a>
            <a href="#user-list" class="sidebar-link">üë• Lista de Usuarios</a>
            <a href="{{ url_for('main.index') }}" class="sidebar-link">‚Üê Volver al Inicio</a>
        </nav>
    </aside>

    <main class="admin-content">
        
        {# Mostrar mensajes flash (√©xito o error) #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {# ========================================================================= #}
        {# 1. GESTI√ìN DE LIBROS (CRUD) #}
        {# ========================================================================= #}
        <section id="books-management" class="tab-content active">
            <h2>üìö Gesti√≥n de Libros</h2>
            
            {# --- Formulario para Crear/Subir Libro --- #}
            <div class="card mb-4">
                <h3>Subir Nuevo Libro</h3>
                {# Vinculado a la RUTA CREATE: /admin/books/add #}
                <a href="{{ url_for('admin.add_book') }}" class="btn btn-success mt-3">Ir a Formulario de Subida</a>
            </div>

            {# --- Listado y Acciones de Libros Existentes (Tabla) --- #}
            <h3>Libros Existentes ({{ books|length }} items)</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√≠tulo</th>
                        <th>Autor (ID)</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {# Bucle Jinja2 para mostrar los libros #}
                    {% for book in books %}
                    <tr>
                        <td>{{ book.id }}</td>
                        <td>{{ book.title }}</td>
                        {# Asumimos que Author_id existe en el modelo Book #}
                        <td>{{ book.author_id or 'N/A' }}</td>
                        <td>${{ book.price | round(2) }}</td>
                        <td>{{ book.quantity }}</td>
                        <td>
                            {# RUTA UPDATE: /admin/books/edit/<id> #}
                            <a href="{{ url_for('admin.edit_book', book_id=book.id) }}" class="btn-sm btn-edit">Editar</a>

                            {# RUTA DELETE: /admin/books/delete/<id> (M√©todo POST) #}
                            <form method="POST" action="{{ url_for('admin.delete_book', book_id=book.id) }}" style="display:inline;">
                                <button type="submit" class="btn-sm btn-danger" onclick="return confirm('¬øSeguro que deseas eliminar el libro {{ book.title }}?');">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {# {% else %} <tr><td colspan="6">No hay libros registrados.</td></tr> {% endif %} #}
                </tbody>
            </table>
        </section>

        {# ========================================================================= #}
        {# 2. REVISI√ìN DE CONSULTAS Y PROPUESTAS (Usando solo HTML de muestra) #}
        {# ========================================================================= #}
        <section id="queries-review" class="tab-content">
            <h2>üìß Consultas y Propuestas Pendientes</h2>
            <p>Secci√≥n para revisar manuscritos enviados por Autores o consultas de Editores.</p>
            {# ... Contenido est√°tico de consultas ... #}
        </section>

        {# ========================================================================= #}
        {# 3. LISTA DE USUARIOS (Roles) #}
        {# ========================================================================= #}
        <section id="user-list" class="tab-content">
            <h2>üë• Lista de Usuarios Registrados ({{ users|length }} en total)</h2>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Acciones Admin</th>
                    </tr>
                </thead>
                <tbody>
                    {# Bucle Jinja2 para mostrar los usuarios #}
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.email }}</td>
                        
                        {# L√≥gica Jinja2 para determinar el rol (se basa en el campo is_admin) #}
                        <td>
                            {% if user.is_admin %}
                                <span class="role-tag admin">ADMIN</span>
                            {% else %}
                                <span class="role-tag client">CLIENTE</span>
                                {# Aqu√≠ podr√≠as agregar m√°s checks: {% elif user.is_author %} #}
                            {% endif %}
                        </td>
                        
                        <td>
                            <a href="{{ url_for('admin.edit_user_role', user_id=user.id) }}" class="btn-sm btn-edit">Editar Rol</a>
                            {# Asume una ruta para eliminar usuarios: url_for('admin.delete_user', user_id=user.id) #}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

    </main>
</body>
</html>